#include "hwsw_functions.h"


void SobelFilter_Init() {
	SobelFilter_INTR = 0;

	xSobelFilter.Control_bus_BaseAddress = XPAR_SOBEL_FILTER_TOP_0_S_AXI_CONTROL_BUS_BASEADDR;
	xSobelFilter.IsReady = XIL_COMPONENT_IS_READY;
	config_sobelfilter(xSobelFilter);
	resetVDMA(XPAR_AXI_VDMA_1_BASEADDR);
	config_filterVDMA(XPAR_AXI_VDMA_1_BASEADDR, DMA_MEM_TO_DEV, VIDEO_BASEADDR_CPU0);
	config_filterVDMA(XPAR_AXI_VDMA_1_BASEADDR, DMA_DEV_TO_MEM, VIDEO_BASEADDR_CPU0 + FRAME_SIZE);
}



void ErodeFilter_Init() {
	ErodeFilter_INTR = 0;

	xErodeFilter.Control_bus_BaseAddress = XPAR_IMAGE_FILTER_TOP_0_S_AXI_CONTROL_BUS_BASEADDR;
	xErodeFilter.IsReady = XIL_COMPONENT_IS_READY;
	config_erodefilter(xErodeFilter);
	resetVDMA(XPAR_AXI_VDMA_3_BASEADDR);
	config_filterVDMA(XPAR_AXI_VDMA_3_BASEADDR, DMA_MEM_TO_DEV, VIDEO_BASEADDR_CPU0 + FRAME_SIZE);
	config_filterVDMA(XPAR_AXI_VDMA_3_BASEADDR, DMA_DEV_TO_MEM, VIDEO_BASEADDR_CPU0 + FRAME_SIZE*2);
}



void GrayscaleFilter_Init() {
	GrayscaleFilter_INTR = 0;

	xGrayScaleFilter.Control_bus_BaseAddress = XPAR_GRAY_SCALE_TOP_0_S_AXI_CONTROL_BUS_BASEADDR;
	xGrayScaleFilter.IsReady = XIL_COMPONENT_IS_READY;
	config_grayScaleFilter(xGrayScaleFilter);
	resetVDMA(XPAR_AXI_VDMA_1_BASEADDR);
	config_filterVDMA(XPAR_AXI_VDMA_1_BASEADDR, DMA_MEM_TO_DEV, VIDEO_BASEADDR_CPU0 + FRAME_SIZE*2);
	config_filterVDMA(XPAR_AXI_VDMA_1_BASEADDR, DMA_DEV_TO_MEM, VIDEO_BASEADDR_CPU0 + FRAME_SIZE*3);
}



void HA_Initialize() {
	SobelFilter_Init();
	ErodeFilter_Init();
	GrayscaleFilter_Init();
}



void SobelFilter_vdmaISR(void * baseaddr_p)
{
	Xil_Out32((SobelFilter_VDMA_BASEADDR + AXI_FILTER_RX_CTRL), 0x00000004);
	SobelFilter_INTR = 1;
}

void ErodeFilter_vdmaISR(void * baseaddr_p)
{
	Xil_Out32((ErodeFilter_VDMA_BASEADDR + AXI_FILTER_RX_CTRL), 0x00000004);
	ErodeFilter_INTR = 1;
}

void GrayscaleFilter_vdmaISR(void * baseaddr_p)
{
	Xil_Out32((GrayscaleFilter_VDMA_BASEADDR + AXI_FILTER_RX_CTRL), 0x00000004);
	GrayscaleFilter_INTR = 1;
}









