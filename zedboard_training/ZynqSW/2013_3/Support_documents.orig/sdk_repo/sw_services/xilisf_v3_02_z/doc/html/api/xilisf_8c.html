<html>
<head>
   <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>
   Xilinx Driver xilisf v3_02_a: xilisf.c File Reference
</title>
<link href="../../../../../../../doc/usenglish/css/driver_api_doxygen.css" rel="stylesheet" type="text/css">
</head>
<h3 class="PageHeader">Xilinx Processor IP Library</h3>
<hl>Software Drivers</hl>
<hr class="whs1">

<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>xilisf.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains the library functions to initialize, control and read the device information of the Serial Flash devices. Refer xilisf.h for detailed description.<p>
<pre></pre><p>
<pre> MODIFICATION HISTORY:</pre><p>
<pre> Ver   Who      Date     Changes
 ----- -------  -------- -----------------------------------------------
 1.00a ksu/sdm  03/03/08 First release
 1.00a sdm      07/02/08 Changed the initialization so that the SPI
			  Master works in Spi Mode 3 as the In-System Flash
			  works only in Spi Mode 3
 2.00a ktn      11/27/09 Updated to use HAL processor APIs/definitions
 2.01a sdm      01/04/10 Added Support for Winbond W25QXX/W25XX devices
			  The parameter PagesPerBlock in the struct
			  <a class="el" href="struct_intel_stm_device_geometry.html">IntelStmDeviceGeometry</a> has been renamed to
			  PagesPerSector.
 2.03a sdm      04/17/10 Updated to support Winbond memory W25Q128.
 2.04a sdm      08/17/10 Updated to support Numonyx (N25QXX) and Spansion
			  flash memories
 3.00a srt	 06/20/12 Updated to support interfaces SPI PS and QSPI PS.
			  New API:
			  	XIsf_RegisterInterface()
				<a class="el" href="xilisf_8c.html#8e798caaadba189d7c58d2c5f465cca6">XIsf_SetSpiConfiguration()</a>
				XIsf_SetTransferMode()
			  Changed API:
			 	<a class="el" href="xilisf_8c.html#8cf6d3ea1d0f1079bd531ca57cd51d38">XIsf_Initialize()</a>
				XIsf_Transfer()
			  Added support to SST flash.
 3.01a srt	 02/06/13 Updated for changes made in QSPIPS driver (CR 698107).</pre><p>
<pre> </pre> 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_atmel_device_geometry.html">AtmelDeviceGeometry</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_intel_stm_device_geometry.html">IntelStmDeviceGeometry</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#8cf6d3ea1d0f1079bd531ca57cd51d38">XIsf_Initialize</a> (XIsf *InstancePtr, XIsf_Iface *SpiInstPtr, u8 SlaveSelect, u8 *WritePtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#8e798caaadba189d7c58d2c5f465cca6">XIsf_SetSpiConfiguration</a> (XIsf *InstancePtr, XIsf_Iface *SpiInstPtr, u32 Options, u8 PreScaler)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#f9e923695acb160567e5b2ee5405cdc8">XIsf_GetStatus</a> (XIsf *InstancePtr, u8 *ReadPtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#37339d1c0f7a4e8c8735db401a3659fb">XIsf_GetStatusReg2</a> (XIsf *InstancePtr, u8 *ReadPtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#6fd573ac93cecf50f100894a93774702">XIsf_GetDeviceInfo</a> (XIsf *InstancePtr, u8 *ReadPtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#72fc96978815e12c52ea31736204ff2e">XIsf_WriteEnable</a> (XIsf *InstancePtr, u8 WriteEnable)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilisf_8c.html#69d16b55d531cf40db09e425d347d09f">XIsf_Ioctl</a> (XIsf *InstancePtr, XIsf_IoctlOperation Operation)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="6fd573ac93cecf50f100894a93774702"></a><!-- doxytag: member="xilisf.c::XIsf_GetDeviceInfo" ref="6fd573ac93cecf50f100894a93774702" args="(XIsf *InstancePtr, u8 *ReadPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_GetDeviceInfo           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>ReadPtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This API reads the Joint Electron Device Engineering Council (JEDEC) information of the Serial Flash.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ReadPtr</em>&nbsp;</td><td>is a pointer to the buffer where the Device information is copied.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS if successful else XST_FAILURE.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>The Device information is stored at the second byte pointed by the ReadPtr. </dd></dl>

</div>
</div><p>
<a class="anchor" name="f9e923695acb160567e5b2ee5405cdc8"></a><!-- doxytag: member="xilisf.c::XIsf_GetStatus" ref="f9e923695acb160567e5b2ee5405cdc8" args="(XIsf *InstancePtr, u8 *ReadPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_GetStatus           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>ReadPtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This API reads the Serial Flash Status Register.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ReadPtr</em>&nbsp;</td><td>is a pointer to the memory where the Status Register content is copied.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS if successful else XST_FAILURE.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>The contents of the Status Register is stored at the second byte pointed by the ReadPtr. </dd></dl>

</div>
</div><p>
<a class="anchor" name="37339d1c0f7a4e8c8735db401a3659fb"></a><!-- doxytag: member="xilisf.c::XIsf_GetStatusReg2" ref="37339d1c0f7a4e8c8735db401a3659fb" args="(XIsf *InstancePtr, u8 *ReadPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_GetStatusReg2           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>ReadPtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This API reads the Serial Flash Status Register 2.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ReadPtr</em>&nbsp;</td><td>is a pointer to the memory where the Status Register content is copied.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS if successful else XST_FAILURE.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>The contents of the Status Register 2 is stored at the second byte pointed by the ReadPtr. This operation is available only in Winbond Serial Flash. </dd></dl>

</div>
</div><p>
<a class="anchor" name="8cf6d3ea1d0f1079bd531ca57cd51d38"></a><!-- doxytag: member="xilisf.c::XIsf_Initialize" ref="8cf6d3ea1d0f1079bd531ca57cd51d38" args="(XIsf *InstancePtr, XIsf_Iface *SpiInstPtr, u8 SlaveSelect, u8 *WritePtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_Initialize           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XIsf_Iface *&nbsp;</td>
          <td class="paramname"> <em>SpiInstPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8&nbsp;</td>
          <td class="paramname"> <em>SlaveSelect</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>WritePtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The geometry of the underlying Serial Flash is determined by reading the Joint Electron Device Engineering Council (JEDEC) Device Information and the Status Register of the Serial Flash. This API when called initializes the SPI interface with default settings. With custom settings, user should call <a class="el" href="xilisf_8c.html#8e798caaadba189d7c58d2c5f465cca6">XIsf_SetSpiConfiguration()</a> and then call this API.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>SpiInstPtr</em>&nbsp;</td><td>is a pointer to the XIsf_Iface instance to be worked on. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>SlaveSelect</em>&nbsp;</td><td>is a 32-bit mask with a 1 in the bit position of the slave being selected. Only one slave can be selected at a time. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>WritePtr</em>&nbsp;</td><td>is a pointer to the buffer allocated by the user to be used by the In-system and Serial Flash Library to perform any read/write operations on the Serial Flash device. User applications must pass the address of this buffer for the Library to work.<ul>
<li>Write operations :<ul>
<li>The size of this buffer should be equal to the Number of bytes to be written to the Serial Flash + XISF_CMD_MAX_EXTRA_BYTES.</li><li>The size of this buffer should be large enough for usage across all the applications that use a common instance of the Serial Flash.</li><li>A minimum of one byte and a maximum of ISF_PAGE_SIZE bytes can be written to the Serial Flash, through a single Write operation.</li></ul>
</li><li>Read operations :<ul>
<li>The size of this buffer should be equal to XISF_CMD_MAX_EXTRA_BYTES, if the application only reads from the Serial Flash (no write operations).</li></ul>
</li></ul>
</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>- XST_SUCCESS if successful.<ul>
<li>XST_DEVICE_IS_STOPPED if the device must be started before transferring data.</li><li>XST_FAILURE, otherwise.</li></ul>
</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>- The <a class="el" href="xilisf_8c.html#8cf6d3ea1d0f1079bd531ca57cd51d38">XIsf_Initialize()</a> API is a blocking call (for both polled and interrupt modes of the Spi driver). It reads the JEDEC information of the device and waits till the transfer is complete before checking if the information is valid.<ul>
<li>This library can support multiple instances of Serial Flash at a time, provided they are of the same device family (either Atmel, Intel or STM, Winbond or Spansion) as the device family is selected at compile time. </li></ul>
</dd></dl>

</div>
</div><p>
<a class="anchor" name="69d16b55d531cf40db09e425d347d09f"></a><!-- doxytag: member="xilisf.c::XIsf_Ioctl" ref="69d16b55d531cf40db09e425d347d09f" args="(XIsf *InstancePtr, XIsf_IoctlOperation Operation)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_Ioctl           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XIsf_IoctlOperation&nbsp;</td>
          <td class="paramname"> <em>Operation</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This API configures and controls the Intel, STM, Winbond and Spansion Serial Flash.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Operation</em>&nbsp;</td><td>is the type of Control operation to be performed on the Serial Flash. The different control operations are<ul>
<li>XISF_RELEASE_DPD: Release from Deep Power Down (DPD) Mode</li><li>XISF_ENTER_DPD: Enter DPD Mode</li><li>XISF_CLEAR_SR_FAIL_FLAGS: Clear the Status Register Fail Flags</li></ul>
</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS if successful else XST_FAILURE.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd><ul>
<li>Atmel Serial Flash does not support any of these operations.</li><li>Intel Serial Flash support Enter/Release from DPD Mode and Clear Status Register Fail Flags.</li><li>STM, Winbond and Spansion Serial Flash support Enter/Release from DPD Mode.</li><li>Winbond (W25QXX) Serial Flash support Enable High Performance mode. </li></ul>
</dd></dl>

</div>
</div><p>
<a class="anchor" name="8e798caaadba189d7c58d2c5f465cca6"></a><!-- doxytag: member="xilisf.c::XIsf_SetSpiConfiguration" ref="8e798caaadba189d7c58d2c5f465cca6" args="(XIsf *InstancePtr, XIsf_Iface *SpiInstPtr, u32 Options, u8 PreScaler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_SetSpiConfiguration           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XIsf_Iface *&nbsp;</td>
          <td class="paramname"> <em>SpiInstPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&nbsp;</td>
          <td class="paramname"> <em>Options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8&nbsp;</td>
          <td class="paramname"> <em>PreScaler</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This API sets the configuration of SPI. This will set the options and clock prescaler (if applicable).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>SpiInstPtr</em>&nbsp;</td><td>is a pointer to the XIsf_Iface instance to be worked on. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Options</em>&nbsp;</td><td>contains specified options to be set. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>PreScaler</em>&nbsp;</td><td>is the value of the clock prescaler to set.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS if successful else XST_FAILURE.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>This API can be called before calling <a class="el" href="xilisf_8c.html#8cf6d3ea1d0f1079bd531ca57cd51d38">XIsf_Initialize()</a> to initialize the SPI interface in other than default options mode. PreScaler is only applicable to PS SPI/QSPI. </dd></dl>

</div>
</div><p>
<a class="anchor" name="72fc96978815e12c52ea31736204ff2e"></a><!-- doxytag: member="xilisf.c::XIsf_WriteEnable" ref="72fc96978815e12c52ea31736204ff2e" args="(XIsf *InstancePtr, u8 WriteEnable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIsf_WriteEnable           </td>
          <td>(</td>
          <td class="paramtype">XIsf *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8&nbsp;</td>
          <td class="paramname"> <em>WriteEnable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This API Enables/Disables writes to the Intel, STM, Winbond and Spansion Serial Flash.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the XIsf instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>WriteEnable</em>&nbsp;</td><td>specifies whether to Enable (XISF_CMD_ENABLE_WRITE) or Disable (XISF_CMD_DISABLE_WRITE) the writes to the Serial Flash.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS if successful else XST_FAILURE.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>This API works only for Intel, STM, Winbond and Spansion Serial Flash. If this API is called for Atmel Flash, XST_FAILURE is returned. </dd></dl>

</div>
</div><p>
<p class="Copyright">
Copyright &copy; 1995-2011 Xilinx, Inc. All rights reserved.
</p>
</body>
</html>

